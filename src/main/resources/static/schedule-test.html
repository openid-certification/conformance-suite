<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>OIDF Conformance: Conformance Suite</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Boostrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans">
    <link rel="stylesheet" type="text/css" href="css/layout.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Popper (necessary for Bootstrap's tooltips) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script type="text/javascript" src="js/fapi.ui.js"></script>

</head>
<body>

    <div class="pageHeader container-fluid">
        <div class="row">
            <div class="col-md-7">
                <a href="index.html"><img src="/images/openid.png"></a>
            </div>
            <div id="userInfoHolder" class="col-md-5"></div>
        </div>
    </div>
    <div class="clearfix"></div>

    <!-- error modal -->
    <div class="modal" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="errorLabel">Error</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Error: <span id="errorMessage"></span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-light bg-gradient border border-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- loading modal -->
    <div class="modal" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="errorLabel" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="loadingLabel">Loading...</h4>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <img src="/images/spinner.gif" width="100px" height="30px" />
                    </div>
                    <div>
                        <span id="loadingMessage"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="container-fluid">
        <div id="scheduleTestPage">

            <div class="row">
                <div class="col-md-12">
                    <p>Please see <a href="https://openid.net/certification/instructions/">OpenID Foundation Certification Instructions</a>.</p>
                </div>
            </div>

            <div class="mb-3 row">
                <label for="planSelect" class="col-md-2 col-form-label">Test Plan</label>
                <div class="col-md-10">
                    <div class="input-group">
                        <div class="input-group-text">
                            <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="Test plan name. This selects whether you are testing a Relying Party (client) or OpenID Provider (authorization server). It also selects which exact tests you want to run. UK Openbanking compliant systems should select 'FAPI-RW-ID2'"></span>
                        </div>
                        <select id="planSelect" class="form-select">
                            <option value="select">--- Select A Test Plan ----</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <form id="variantSelectors">
                        <!-- render variant selectors here -->
                    </form>
                </div>
            </div>

            <div class="row" id="configForm">
                <div class="col-md-12">

                    <h3>Configure Test</h3>

                    <ul class="nav nav-tabs">
                      <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" id="tab-form-elements" href="#formInput">Form</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" id="tab-json-elements" href="#JSONInput">JSON</a></li>
                      </li>
                    </ul>

                    <div class="tab-content">
                        <div id="formInput" class="tab-pane in active">

                            <div class="config-form-container">

                                <h3 class="config-form-container-header">Test Information</h3>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">alias</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Used to make any URLs used in the test unique to the user (for example, it affects the redirect url), set to something unique to avoid clashes with other testers, e.g. set to your company name. Do not include any spaces or non-URL safe characters. If using dynamic client registration, this can be left blank and a random one will be generated. For some ecosystems (e.g. KSA) regulated entities should use the alias value assigned to them."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="alias"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">description</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Freeform text to help you identify this test run (optional). This will be publicly visible when your certification is published."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="description"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">publish</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Whether test results should be made visible to other users. &quot;Everything&quot; will reveal configuration information, including secret keys. Use &quot;summary&quot; if these details should remain private while the overall results are public. If in doubt choose &quot;No&quot; - test results can be made public later."></span>
                                            </div>
                                            <select class="form-control config-form-element" data-json-target="publish">
                                                <option value="" selected>No</option>
                                                <option value="summary">Summary</option>
                                                <option value="everything">Everything</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">SSF Transmitter</h3>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Transmitter Issuer</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Transmitter's issuer URL."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="ssf.transmitter.issuer"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Transmitter Configuration URL</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Transmitter's Configuration URL."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="ssf.transmitter.configuration_metadata_endpoint"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Transmitter Metadata Suffix</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Suffix to append to the ssf-configuration URL."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="ssf.transmitter.metadata_suffix"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Transmitter access_token</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Access token to use in SSF request. This may be left empty, in which case the request will not contain an access token."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="ssf.transmitter.access_token"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Push Endpoint URL</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Receiver endpoint URL to push events to on PUSH delivery mode."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="ssf.transmitter.push_endpoint"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Push Authorization Header</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Authorization header value to use with the PUSH delivery mode."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="ssf.transmitter.push_endpoint_authorization_header"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">SSF Stream Audience</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Audience to use for the SSF Stream."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="ssf.stream.audience"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">SSF valid SubjectId</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Existing SubjectId to generate events."></span>
                                            </div>
                                            <textarea type="text" class="form-control config-form-element" data-json-target="ssf.subjects.valid" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">SSF invalid SubjectId</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Invalid non existing SubjectId to generate events."></span>
                                            </div>
                                            <textarea type="text" class="form-control config-form-element" data-json-target="ssf.subjects.invalid" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Server</h3>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">issuer</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Full URL that server will use as the 'iss' value in id_token."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.issuer"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">jwks_uri</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Full URL to server's JWKS endpoint."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.jwks_uri"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">authorization_endpoint</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Full URL to server's authorization endpoint. When testing a wallet use 'openid4vp://' or similar."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.authorization_endpoint"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">token_endpoint</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Full URL to server's token endpoint."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.token_endpoint"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">userinfo_endpoint</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Full URL to server's userinfo endpoint."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.userinfo_endpoint"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">acr_values</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Space separated list of server's supported acr values that will be sent in the acr_values field; if left blank '1 2' is the default."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.acr_values"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">discoveryUrl</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Full URL to server's .well-known/openid-configuration."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.discoveryUrl"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">discoveryIssuer</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Server's issuer URL."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.discoveryIssuer"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">jwks</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Private key to be used by the server to sign id_tokens, this should be one key in JSON Web Key Set format."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="server.jwks" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">login_hint</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="A value that the server accepts in the login_hint parameter. If not specified a default value ('buffy@<your issuer>') will be used."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.login_hint"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">ui_locales</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="A value that the server accepts in the ui_locales parameter. If not specified a default value ('se') will be used."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="server.ui_locales"></input>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Client</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_id</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="OAuth client id used with the authorization server. For OID4VP tests this can be left blank if using x509_san_dns or redirect_uri client id schemes."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.client_id"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_secret</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Client secret."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.client_secret"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_name</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Client name to use in dynamic registration request. This may be left empty, in which case a random name is used."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.client_name"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">initial_access_token</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Access token to use in dynamic registration request. This may be left empty, in which case the request will not contain an access token."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.initial_access_token"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">scope</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Scopes to use in authorization request, e.g. 'openid accounts'. For Brazil, you may use the 'accounts' or the 'payments' scope depending which API endpoint you want to use for testing."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.scope"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">authorization_encrypted_response_alg</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JWE alg algorithm for encrypting the JARM response issued to this Client, e.g RSA-OAEP or ECDH-ESP. For VP tests this can be left empty and the suite will use a default."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.authorization_encrypted_response_alg"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">authorization_encrypted_response_enc</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JWE enc algorithm for encrypting the JARM response issued to this Client, e.g. A128CBC-HS256 or A256GCM. For VP tests this can be left empty and the suite will use a default."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.authorization_encrypted_response_enc"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">presentation_definition</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="presentation_definition to use in authorization request"></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="client.presentation_definition" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">dcql</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="The DCQL (Digital Credentials Query Language) to use in dcql_query parameter in authorization request"></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="client.dcql" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">redirect_uri</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="URI the conformance suite should redirect back to with the result of the authorization endpoint call appended."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.redirect_uri"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">backchannel_<wbr>client_<wbr>notification_<wbr>endpoint</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="This is the endpoint to which the conformance suite will post a notification after a successful or failed end-user authentication."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.backchannel_client_notification_endpoint"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">jwks</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Client's private signing key in JSON Web Key Set format, must begin with { &quot;keys&quot;: [ {    PEM/DER format private keys MUST be correctly converted to a JWKS, e.g. using 'pem-jwk'. The JWKS should normally contain exactly one JWK, which will be used for client assertions / signing requests, and must contain an 'alg' field indicating what algorithm to use. If the OP issues encrypted id tokens a key with 'use': 'enc' must be provided, which must be the second entry in the JWKS."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="client.jwks" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">organization jwks</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Organizations's BRSEAL private signing key in JSON Web Key Set format, to be used to sign API requests to the payment consent creation/payment initiation endpoints. This key must be for the organization listed in the client's TLS certificate subjectdn. Only required if 'scope' contains 'payments'."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="client.org_jwks" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_secret_jwt_alg</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Algorithm for client_secret_jwt authentication, defaults to HS256."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.client_secret_jwt_alg"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">id_token_encrypted_response_alg</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JWE alg algorithm for encrypting the ID Token issued to this Client, e.g RSA-OAEP."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.id_token_encrypted_response_alg"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">id_token_encrypted_response_enc</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JWE enc algorithm for encrypting the ID Token issued to this Client, defaults to A128CBC-HS256."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.id_token_encrypted_response_enc"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">certificate</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="TLS client certificate in base64-encoded DER (in JSON string, no headers) or OpenSSL/PEM format - often has .pem file extension."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="client.certificate"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">hint_type</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Type of hint to identify user. For Open Finance Brazil, only login_hint and id_token_hint are allowed."></span>
                                            </div>
                                            <select class="form-control config-form-element" data-json-target="client.hint_type">
                                                <option value="" selected>None</option>
                                                <option value="login_hint_token">login_hint_token</option>
                                                <option value="id_token_hint">id_token_hint</option>
                                                <option value="login_hint">login_hint</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">hint_value</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Hint value to identify user, e.g. a login_hint, login_hint_token or id_token_hint."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.hint_value"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">post_logout_redirect_uri</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="URI the conformance suite should redirect back to after the end_session_endpoint call."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.post_logout_redirect_uri"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">frontchannel_logout_uri</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Front channel logout URI."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.frontchannel_logout_uri"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">backchannel_logout_uri</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Back channel logout URI."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.backchannel_logout_uri"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">DPoP Signing Alg</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-toggle="tooltip" data-placement="bottom" title="JWS algorithm for signing DPoP proofs"></span>
                                            </div>
                                            <select class="form-select config-form-element" data-json-target="client.dpop_signing_alg">
                                                <option value="PS256" selected>PS256</option>
                                                <option value="ES256">ES256</option>
                                                <option value="EdDSA">EdDSA</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">tls_client_auth configuration (Enter <u>only one</u> of the following)</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">tls_client_auth_subject_dn</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Certificate subject DN, e.g cn=certification.example.com,o=oidf,st=ca,c=us."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.tls_client_auth_subject_dn"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">tls_client_auth_san_dns</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="DNSname subject alternative name, e.g client.example.com."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.tls_client_auth_san_dns"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">tls_client_auth_san_uri</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="URI subject alternative name, e.g https://example.com."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.tls_client_auth_san_uri"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">tls_client_auth_san_ip</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="IP address subject alternative name, e.g 10.0.0.1 or 2001:0db8:85a3:0000:0000:8a2e:0370:7334."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.tls_client_auth_san_ip"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">tls_client_auth_san_email</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Email address subject alternative name, e.g john@example.com."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client.tls_client_auth_san_email"></input>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">TLS certificates for client (used to make MTLS connections)</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">mtls.cert</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="TLS client certificate in base64-encoded DER (in JSON string, no headers) or OpenSSL/PEM format - often has .pem file extension."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="mtls.cert"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">mtls.key</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unencrypted TLS client key in base64-encoded DER or PEM format (in JSON string no headers) or OpenSSL/PEM format."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="mtls.key"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">mtls.ca</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="TLS client CA in base64-encoded DER (in JSON string, no headers) or OpenSSL/PEM format. Optional, can be omitted if using self-signed certificates or if the server does not require any certificate authority elements to be supplied."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="mtls.ca"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Client for client_secret_post</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_id</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="OAuth client id used with the authorization server for a client that supports client_secret_post. If the server allows a single client to use both client_secret_basic and client_secret_post then this can be the same client as above."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client_secret_post.client_id"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_secret</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Client secret for a client that supports client_secret_post. If the server allows a single client to use both client_secret_basic and client_secret_post then this can be the same client as above."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client_secret_post.client_secret"></input>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Second client</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_id</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="OAuth client id used with the authorization server."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.client_id"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_secret</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Client secret"></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.client_secret"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_name</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Second client name to use in dynamic registration request. This may be left empty, in which case a random name is used."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.client_name"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">initial_access_token</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Access token to use in dynamic registration request. This may be left empty, in which case the request will not contain an access token."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.initial_access_token"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">scope</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Scopes to use in authorization request, e.g. 'openid accounts'."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.scope"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">redirect_uri</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="URI the conformance suite should redirect back to with the result of the authorization endpoint call appended."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.redirect_uri"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">jwks</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Second client's private signing key in JSON Web Key Set format, must begin with { &quot;keys&quot;: [ {    PEM/DER format private keys MUST be correctly converted to a JWKS, e.g. using 'pem-jwk'. The JWKS should normally contain exactly one JWK, which will be used for client assertions / signing requests, and must contain an 'alg' field indicating what algorithm to use. If the OP issues encrypted id tokens a key with 'use': 'enc' must be provided, which must be the second entry in the JWKS. The key must be different to that for the first client."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="client2.jwks" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">organization jwks</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Second client's organization's BRSEAL private signing key in JSON Web Key Set format, to be used to sign API requests to the payment consent creation/payment initiation endpoints. This key must be for the organization listed in the client's TLS certificate subjectdn. Both clients can be from the same organization, in which case the same organization private key should be provided for both clients. Only required if 'scope' contains 'payments'."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="client2.org_jwks" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">certificate</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="TLS client certificate in base64-encoded DER (in JSON string, no headers) or OpenSSL/PEM format - often has .pem file extension."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="client2.certificate"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">client_secret_jwt_alg</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Algorithm for client_secret_jwt authentication, defaults to HS256."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.client_secret_jwt_alg"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">id_token_encrypted_response_alg</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JWE alg algorithm for encrypting the ID Token issued to this Client, e.g RSA-OAEP."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.id_token_encrypted_response_alg"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">id_token_encrypted_response_enc</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JWE enc algorithm for encrypting the ID Token issued to this Client, defaults to A128CBC-HS256."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.id_token_encrypted_response_enc"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">acr_value</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="If this server supports acr, this should contain a valid acr value that can be requested in an authentication request, e.g. 'urn:openbanking:psd2:sca'."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="client2.acr_value"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">DPoP Signing Alg</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-toggle="tooltip" data-placement="bottom" title="JWS algorithm for signing DPoP proofs"></span>
                                            </div>
                                            <select class="form-select config-form-element" data-json-target="client2.dpop_signing_alg">
                                                <option value="PS256" selected>PS256</option>
                                                <option value="ES256">ES256</option>
                                                <option value="EdDSA">EdDSA</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Second client TLS certificates</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">mtls2.cert</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="TLS client certificate in base64-encoded DER (in JSON string, no headers) or OpenSSL/PEM format."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="mtls2.cert"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">mtls2.key</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unencrypted TLS client key in base64-encoded DER or PEM format (in JSON string no headers) or OpenSSL/PEM format."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="mtls2.key"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">mtls2.ca</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="TLS client CA in base64-encoded DER (in JSON string, no headers) or OpenSSL/PEM format."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="mtls2.ca"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">TLS</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">testHost</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Hostname for TLS connection tests (only used in sample-test-test)."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="tls.testHost"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">testPort</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Port number for TLS connection tests (only used in sample-test-test)."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="tls.testPort"></input>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Resource</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">resourceUrl</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="URL to use in resource server tests, must return a JSON response. For UK OpenBanking tests, this should be the base url for UK AISP APIs and hence must end '/open-banking/vX.Y/aisp/' (this form of URL is required by the UK OpenBanking specs). For Brazil OpenBanking you should use the accounts endpoint url, or the payments endpoint if you specify payments in the scope. For Brazil OpenInsurance, use the resources endpoint url. For KSA OpenBanking, use the accounts endpoint url."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.resourceUrl"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">consentUrl</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="URL for the consent endpoint. This should be the data read consent endpoint. If you are testing OpenBanking payments, it should be the payment initiation consent endpoint and you should include 'payments' in the scope field."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.consentUrl"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">resourceUrlAccountRequests</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Base URL to use in resource account request server tests. For UK OpenBanking: optional, use if endpoints split across servers. For SAMA/KSA OpenBanking: the full url for the account-access-consents endpoint."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.resourceUrlAccountRequests"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">resourceUrlAccountsResource</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Base URL to use in resource accounts server tests (optional, use if endpoints split across servers)."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.resourceUrlAccountsResource"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">cdrVersion</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="The version number to send in the x-v HTTP header to the resource endpoint."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.cdrVersion"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">brazilCpf</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="The 'CPF' value to be used in the consent creation request. At least one of CPF or CNPJ must be supplied."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.brazilCpf"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">brazilCnpj</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="The 'CNPJ' value to be used in the consent creation request. At least one of CPF or CNPJ must be supplied."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.brazilCnpj"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Business or Personal Products</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="For accounts/resources tests, whether test should be run for Business or Personal Products."></span>
                                            </div>
                                            <select class="form-control config-form-element" data-json-target="consent.productType">
                                                <option value="business" selected>Business Products</option>
                                                <option value="personal">Personal Products</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Resource server organization id</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="The organization id for the resource server, as recorded in the directory. Only required if 'scope' contains 'payments'."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.brazilOrganizationId"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Payment consent request JSON</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JSON representation of a payment consent request. This will be used as the body of the request sent to the payment consent endpoint. Only required if 'scope' contains 'payments'."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="resource.brazilPaymentConsent" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Payment initiation request JSON</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JSON representation of a PIX payment request. This will be used as the body of the request sent to the payment initiation endpoint. Only required if 'scope' contains 'payments'."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="resource.brazilPixPayment" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">institution_id</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Financial institution ID to send to FAPI resources, i.e. Institution ID assigned by UK OpenBanking. This can be left empty if the resource server does not require this header."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="resource.institution_id"></input>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Authorization Request JSON</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JSON representation of the authorization. This will be used as the authorization_request parameter of the authorization."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="resource.richAuthorizationRequest" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Supported Authorization Request Types</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="JSON representation of the list of authorization types. This will be used to validate RAR payloads submitted by RPs."></span>
                                            </div>
                                            <input class="form-control config-form-element" data-json-target="resource.authorization_details_types_supported" data-json-type="jsonobject"></input>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Directory</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Discovery Endpoint</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="URL to the OpenBanking Directory. e.g. for Brazil directory sandbox use https://auth.sandbox.directory.openbankingbrasil.org.br/.well-known/openid-configuration"></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="directory.discoveryUrl"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Directory ClientID</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="client_id for this client on the OpenBanking Directory. This is used to obtain an access token, which is used to retrieve the software statement. The MTLS certificate provided for the client MUST be one that can be used to access the OpenBanking directory. An example client/configuration is linked to from the instructions (see link at top of this page)."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="directory.client_id"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Directory API base</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Base URL for the OpenBanking Directory. e.g. for Brazil Directory sandbox use https://matls-api.sandbox.directory.openbankingbrasil.org.br/"></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="directory.apibase"></input>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Directory keystore base</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Keystore URL for the OpenBanking Directory. e.g. for Brazil Directory sandbox use https://keystore.sandbox.directory.openbankingbrasil.org.br/"></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="directory.keystore"></input>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">eKYC</h3>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">ekyc_verified_claims_request</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Custom claims request. Must be a valid json object that can be added directly to the request as the top level 'claims' element."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="ekyc_verified_claims_request" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">ekyc_userinfo</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="A complete set of end-user data as held by the OpenID Provider in the form it would be returned via the userinfo endpoint. Enter the entire userinfo json."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="ekyc_userinfo" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Federation</h3>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">entity_identifier</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="The globally unique URL bound to the entity.
                                                This URL MUST use the https scheme, have a host component, and MAY contain port and path components.
                                                It MUST NOT contain query parameter or fragment components."></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="federation.entity_identifier" />
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">entity_configuration</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Static entity configuration"></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="federation.entity_configuration"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">trust_anchor</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="The entity identifier of the trust anchor"></span>
                                            </div>
                                            <input type="text" class="form-control config-form-element" data-json-target="federation.trust_anchor" />
                                        </div>
                                    </div>
                                </div>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">trust_anchor_jwks</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Pre-configured keys for the entity's trust anchor"></span>
                                            </div>
                                            <textarea placeholder="OPTIONAL" class="form-control config-form-element" data-json-target="federation.trust_anchor_jwks"></textarea>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="config-form-container">
                                <h3 class="config-form-container-header">Credential Issuer</h3>

                                <div class="row config-form-element-container">
                                    <div class="col-md-2 key">Signing JWK</div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Signing key to be used for issuing credentials, in JWK format."></span>
                                            </div>
                                            <textarea class="form-control config-form-element" data-json-target="credential.signing_jwk" data-json-type="jsonobject"></textarea>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>

                        <div id="JSONInput" class="tab-pane">
                            <textarea autocomplete="off" autocorrect="off" autocapitalize="off"
                                      spellcheck="false" id="config" placeholder="{JSON data}"></textarea>
                        </div>
                    </div>
                    <!-- / .tab-content -->
                </div>
            </div>

            <div class="row top10 justify-content-center" id="launchButtons">
                <div class="card" style="width: 28rem;">
                    <div class="card-body">
                        <div class="d-grid">
                            <button class="btn btn-lg btn-primary bg-gradient border border-secondary mb-3" id="createPlanBtn" disabled="">
                                <span class="bi bi-flag-fill"></span> Create Test Plan
                            </button>
                            <button class="btn btn-lg btn-secondary bg-gradient border border-secondary" id="copyPlanUrlBtn" disabled="" data-bs-toggle="modal" data-bs-target="#copyTestPlanUrlModal">
                                <span class="bi bi-clipboard"></span> Share Test Plan Configuration
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="copyTestPlanUrlModal" tabindex="-1" aria-labelledby="copyTestPlanUrlModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="copyTestPlanUrlModalLabel">OpenID Conformance Suite</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            The Test Plan Configuration URL was copied to the clipboard.

                            <p class="alert alert-danger">
                                Please note, that the URL might contain <strong>private keys</strong>, <strong>secrets</strong>, and other <strong>sensitive information</strong> extracted from the Test Plan configuration, and sharing it will reveal these things to the recipient.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        /**
         *
         */
        document.addEventListener("DOMContentLoaded", () => {

            FAPI_UI.showBusy('Loading available tests...');

            FAPI_UI.loadScheduleTestPageTemplates()
            .then(function() {
                return FAPI_UI.getUserInfo();
            }).then(function() {
                return loadAvailableTests();
            }).then(function() {
                return loadAvailablePlans();
            }).then(function() {
                return loadConfig();
            }).then(function() {
                return loadScheduleTestPage();
            }).then(function() {
                return loadServerInfo();
            }).then(function() {
                return applyConfigPreset();
            }).finally(function() {
                FAPI_UI.activeTooltip();
            });
        });

        function applyConfigPreset() {
            let searchParams = new URLSearchParams(window.location.search);
            let testPlanName = searchParams.get("test_plan");
            if (testPlanName && testPlanName in FAPI_UI.availablePlans) {
                let planSelect = document.getElementById("planSelect");
                planSelect.value = testPlanName;

                // trigger change event to update variant and config field visibility
                planSelect.dispatchEvent(new Event('change'));
            }
        }

        function loadAvailableTests() {
            return fetch('/api/runner/available')
                .then((response) => response.json())
                .then((data) => {
                    // save the list of available tests and associated info for later
                    FAPI_UI.availableTests = _.keyBy(data, 'testName');
                })
        }

        function loadAvailablePlans() {
            return fetch('/api/plan/available')
                .then((response) => response.json())
                .then((data) => {
                    FAPI_UI.availablePlans = _.keyBy(data, 'planName');

                    // sort the plans into groups by profile
                    var groupedPlans = _.groupBy(data, 'profile');
                    // consistent ordering for plans
                    var profiles = _.keys(groupedPlans).sort();

                    // render all the plans into the dropdown
                    _.each(profiles, function(profile) {

                        var optGroup = FAPI_UI.logTemplates.TEST_OPTGROUP({
                            label: profile
                        });
                        document.getElementById('planSelect').insertAdjacentHTML('beforeend', optGroup);

                        // note that we're sorting the plans within each group as well
                        _.each(_.sortBy(groupedPlans[profile], 'displayName'), function(item) {
                            document.getElementById('planSelect').insertAdjacentHTML('beforeend', FAPI_UI.logTemplates.TEST_OPTION({
                                val: item.planName,
                                display: item.displayName
                            }));
                        });
                    });
                })
        }

        function saveConfig(config) {
            var localStorage = tryGetStorage('sessionStorage');
            if (localStorage) {
                localStorage.setItem('savedConfig', JSON.stringify(config));
            }
        }

        function clearSavedConfig() {
            var localStorage = tryGetStorage('sessionStorage');
            if (localStorage) {
                localStorage.removeItem('savedConfig');
            }
        }

        function loadConfig() {
            var urlParams = new URLSearchParams(window.location.search);
            var planId = urlParams.get('edit-plan');
            var testId = urlParams.get('edit-test');
            if (planId) {
                return loadPlanConfig(planId);
            } else if (testId) {
                return loadTestConfig(testId);
            } else {
                return loadLastConfig();
            }
        }

        function loadPlanConfig(planId) {
            // Load config of plan from database
            return fetch('/api/plan/' + encodeURIComponent(planId))
                .then((response) => response.json())
                .then((data) => {
                    if (data.config) {
                        // we found a configuration file, load it up
                        const el = document.getElementById('config');
                        el.value = JSON.stringify(data.config, null, 4);
                        updateSelectedTestSelector(data.planName);
                        if (data.variant) {
                            FAPI_UI.selectedVariant = data.variant;
                        }
                    } else {
                        // otherwise set the defaults
                        const el = document.getElementById('config');
                        el.value = JSON.stringify(FAPI_UI.testJSON, null, 4);
                    }
                })
        }

        function loadTestConfig(testId) {
            return fetch('/api/info/' + encodeURIComponent(testId))
                .then((response) => response.json())
                .then((data) => {
                    if (data.config) {
                        // we found a configuration file, load it up
                        const el = document.getElementById('config');
                        el.value = JSON.stringify(data.config, null, 4);
                        updateSelectedTestSelector(data.planName);
                        if (data.variant) {
                            FAPI_UI.selectedVariant = data.variant;
                        }
                    } else {
                        // otherwise set the defaults
                        const el = document.getElementById('config');
                        el.value = JSON.stringify(FAPI_UI.testJSON, null, 4);
                    }
                })
        }

        function loadLastConfig() {
            var localStorage = tryGetStorage('sessionStorage');
            var localSavedConfig;

            try {
                localSavedConfig = localStorage ? JSON.parse(localStorage.getItem('savedConfig')) : null;
                clearSavedConfig();
            } catch (e) {
                localSavedConfig = null;
            }

            // If we left the page with an unsaved config, restore it now.

            if (localSavedConfig) {
                const el = document.getElementById('config');
                el.value = localSavedConfig.config;
                updateSelectedTestSelector(localSavedConfig.planName);
                if (localSavedConfig.variant) {
                    FAPI_UI.selectedVariant = localSavedConfig.variant;
                }
                return true;
            }

            // Otherwise, try to get a config from the server
            return fetch('/api/lastconfig')
                .then((response) => response.json())
                .then((data) => {
                    if (data.config) {
                        // we found a configuration file, load it up
                        const el = document.getElementById('config');
                        el.value = JSON.stringify(data.config, null, 4);
                        updateSelectedTestSelector(data.planName);
                        if (data.variant) {
                            FAPI_UI.selectedVariant = data.variant;
                        }
                    } else {

                        // otherwise set the defaults
                        const el = document.getElementById('config');
                        el.value = JSON.stringify(FAPI_UI.testJSON, null, 4);
                    }
                })
        }

        function updateSelectedTestSelector(planName) {
            const selectElement = document.getElementById('planSelect');
            const selectOptions = selectElement.options;

            for (var opt, j=0; opt=selectOptions[j]; j++) {
                if (opt.value == planName) {
                    selectElement.selectedIndex = j;

                    const e = new Event("change");
                    selectElement.dispatchEvent(e);

                    break;
                }
            }
        }

        function collectFormParametersToParameterObject(dataAttribute, skipValue) {
            let paramValues = [...document.querySelectorAll(`[${dataAttribute}]`)]
                .filter(it => (it.value && it.value !== skipValue))
                .map(it => ({
                    [it.getAttribute(`${dataAttribute}`)]: encodeURIComponent(it.value)
                }));

            const paramObject = paramValues.reduce((acc, obj) => {
                const key = Object.keys(obj)[0];
                const value = obj[key];
                acc[key] = value;
                return acc;
            }, {});
            return paramObject;
        }

        function createTestPlanParameterUrl() {
            let pageUrl = window.location.origin + window.location.pathname;
            let testPlan = document.getElementById("planSelect").value;
            let url = pageUrl + "?test_plan=" + testPlan;
            let dataVariantParameters = collectFormParametersToParameterObject("data-variant-parameter", "select");

            if (Object.keys(dataVariantParameters).length > 0) {
                url += "&" + new URLSearchParams(dataVariantParameters).toString();
            }
            let jsonConfig = document.getElementById("config").value;
            if (jsonConfig) {
                let normalizedJsonConfig = JSON.stringify(JSON.parse(jsonConfig))
                url += "&configJson=" + encodeURIComponent(normalizedJsonConfig);
            }
            return url;
        }

        function loadScheduleTestPage() {

            document.getElementById('createPlanBtn').onclick = function(evt) {

                const planName = document.getElementById('planSelect').value;

                // if the user hasn't picked anything, just bail
                if (!planName || planName == 'select') {
                    FAPI_UI.showError({
                        error: "Please select a test plan from the dropdown list"
                    });
                    return;
                }

                /* Figures out which tab is visible then populates the form appropriately
                this is to ensure that the $('#config') value has properly updated in the event of a
                quick paste into a form field  with no tab switch and then a button press */
                if (document.getElementById('formInput').classList.contains('active')) {
                    updateJSONFromFormElements();
                }

                let invalidFormElements = [...document.querySelectorAll(":invalid")];
                if (invalidFormElements.length > 0) {
                    let invalidJsonTargets = invalidFormElements.map(inputEl => inputEl.dataset.jsonTarget)
                    FAPI_UI.showError({
                        error: "Please fix the reported validation errors: " + invalidJsonTargets.join(",")
                    });
                    return;
                }

                FAPI_UI.showBusy('Creating plan...');

                var selectedVariant = getSelectedVariant();

                // Stash the config in case we are unable to create the test
                saveConfig({ config: document.getElementById('config').value, planName: planName, variant: selectedVariant });

                var createUrl = '/api/plan?planName=' + encodeURIComponent(planName);
                for (var [key, value] of Object.entries(selectedVariant)) {
                    // if the user hasn't picked a value for some variant
                    if (value == 'select') {
                        FAPI_UI.showError({
                            error: "Please select a value for " + key + " from the dropdown list"
                        });
                        return;
                    }
                    createUrl += '&variant=' + encodeURIComponent(JSON.stringify(selectedVariant));
                }

                let planConfig = document.getElementById("config").value;
                fetch(createUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: planConfig,
                })
                .then((response) => {
                    if (!response.ok) {
                        return Promise.reject(response);
                    }

                    return response.json();
                })
                .then((data) => {
                    clearSavedConfig();
                    // forward to the test plan page
                    window.location.assign('/plan-detail.html?plan=' + encodeURIComponent(data.id));
                })
                .catch((error) => {
                    FAPI_UI.hideBusy();

                    if (error instanceof Response) {
                        // We have a 'Response' object.
                        var message = error.statusText;
                        var responseClone = error.clone();

                        error.text()
                        .then(textError => {
                            // Text error thrown by the app
                            if (message === "") {
                                message = textError;
                            }

                            if (error.status == 500) {
                                try {
                                    const errorObj = JSON.parse(textError);
                                    // We have code that throws RunTimeException for bad variant selections etc;
                                    if(errorObj.message) {
                                        message = errorObj.message;
                                    }
                                } catch (e) {
                                    // just use the message we already have
                                    console.log(e);
                                }
                            }

                            FAPI_UI.showError({code: error.status.toString(), error: message});
                        })
                        .catch(error1 => {
                            // JSON error thrown by the app
                            responseClone.json()
                            .then(jsonError => {
                                if (typeof (jsonError) === 'string' && jsonError.length != 0) {
                                    message = jsonError;
                                }

                                FAPI_UI.showError({code: error.status.toString(), error: message});
                            })
                            .catch(genericError => {
                                // Error thrown by the server
                                FAPI_UI.showError({code: error.status.toString(), error: error.statusText});
                            });
                        });
                    } else {
                        // Network error automatically detected by fetch.
                        FAPI_UI.showError({code: "", error: error});
                    }
                });
            };

            let copyPlanUrlBtn = document.getElementById('copyPlanUrlBtn');
            copyPlanUrlBtn.onclick = function(evt)  {
                // sync json with current form
                updateJSONFromFormElements();
                let url = createTestPlanParameterUrl();
                navigator.clipboard.writeText(url);
                // console.log("Copied Testplan URL: %s", url);
            }

            // update field visibility when the selectors change
            document.getElementById('planSelect').addEventListener("change", function(){
                updateVariants();
                updateConfigFieldVisibility();
            });
            document.getElementById('variantSelectors').addEventListener("change", function(){
                updateConfigFieldVisibility();
            });

            // update the config visibility right now
            updateVariants();
            if (FAPI_UI.selectedVariant) {
                var selection = FAPI_UI.selectedVariant;
                _.each(selection, function(value, key) {
                    var el = document.querySelector('.variant-selector[data-variant-parameter="' + key + '"]');

                    if (el != null) {
                        el.value = value;
                    }
                });
            }
            updateConfigFieldVisibility();

            // Config UI
            document.querySelectorAll('.config-form-element')?.forEach(function(element) {
                element.setAttribute("autocomplete", "off");
                element.setAttribute("autocorrect", "off");
                element.setAttribute("autocapitalize", "off");
                element.setAttribute("spellcheck", "false");
            });

            // tab actions
            document.getElementById('tab-form-elements').onclick = function(evt) {
                updateFormElementsFromJSON();
            };

            document.getElementById('tab-json-elements').onclick = function(evt) {
                updateJSONFromFormElements();
            };

            // sync the JSON at least once
            let searchParams = new URLSearchParams(window.location.search);
            let configJson = searchParams.get("configJson");
            if (configJson) {
                document.getElementById("config").value = configJson;
            }

            updateFormElementsFromJSON();

            registerFormValidationForFields();

            FAPI_UI.hideBusy();

        }

        function registerFormValidationForFields() {

            [...document.querySelectorAll(".form-control.config-form-element")]
                .filter(inputEl => inputEl.dataset.jsonType === "jsonobject")
                .forEach(inputEl => {
                    inputEl.addEventListener("blur", function(evt) {
                        let element = evt.currentTarget;
                        validateJSONFromFormElement(element,element.value, element.dataset.jsonType)
                    });
                });
        }

        function updateConfigFieldVisibility() {
            // Hide the entire config form and launch button until a plan/test & all variants are selected.
            document.getElementById('configForm').style.display = 'none';
            document.getElementById('launchButtons').style.display = 'none';

            var fieldsNotToShow = [];

            // multi test plan selected
            var planName = document.getElementById('planSelect').value;

            // if the user hasn't picked anything, disable the create button
            if (!planName || planName == 'select' || !FAPI_UI.availablePlans[planName]) {
                var fieldsToShow = [];
                document.getElementById('createPlanBtn').disabled = true;
            } else {
                var selectedPlan = FAPI_UI.availablePlans[planName];
                var fieldsToShow = selectedPlan.configurationFields;
                fieldsNotToShow = selectedPlan.hidesConfigurationFields;

                // add in any fields from the associated modules
                _.each(selectedPlan.modules, function(module) {
                    if (FAPI_UI.availableTests[module.testModule]) {
                        fieldsToShow = _.uniqBy(fieldsToShow.concat(FAPI_UI.availableTests[module.testModule].configurationFields));
                    }
                });

                var planVariants = selectedPlan.variants;
                var allVariantsSelected = true;
                _.each(getSelectedVariant(), function(v, p) {
                    if (!v || v == 'select') {
                        allVariantsSelected = false;
                    } else {
                        // add in any fields from the selected variant
                        fieldsToShow = _.uniqBy(fieldsToShow.concat(planVariants[p]["variantValues"][v].configurationFields));
                        fieldsNotToShow = _.uniqBy(fieldsNotToShow.concat(planVariants[p]["variantValues"][v].hidesConfigurationFields));
                    }
                });
                document.getElementById('createPlanBtn').disabled = !allVariantsSelected;
                document.getElementById('copyPlanUrlBtn').disabled = !allVariantsSelected;

                if (allVariantsSelected) {
                    document.getElementById('configForm').style.display = '';
                    document.getElementById('launchButtons').style.display = '';
                }
            }

            fieldsToShow = _.difference(fieldsToShow, fieldsNotToShow);
            fieldsToShow.push('alias', 'description', 'publish'); // always show the alias, description, and publish fields

            if (document.getElementById('configForm').style.display !== 'none') {
                // show/hide all the appropriate fields on the page
                document.querySelectorAll(".config-form-element-container")?.forEach(function(element) {
                    const formElement = element.querySelector('.config-form-element');

                    if (_.includes(fieldsToShow, formElement.dataset.jsonTarget)) {
                        element.style.display = '';
                    } else {
                        element.style.display = 'none';
                    }
                });

                // collapse empty sections
                document.querySelectorAll('.config-form-container')?.forEach(function(element) {
                    var hasAtLeastOneDisplayElement = false;

                    for (const child of element.children) {
                        if (child.classList.contains('config-form-container-header')) {
                            continue;
                        }

                        if (child.style.display !== 'none') {
                            hasAtLeastOneDisplayElement = true;
                            // found at least one visible element, break the loop
                            break;
                        }
                    }

                    if (hasAtLeastOneDisplayElement) {
                        element.querySelector('.config-form-container-header').style.display = '';
                    } else {
                        // there are no visible elements anymore, hide the header
                        element.querySelector('.config-form-container-header').style.display = 'none';
                    }
                });
            }
        }

        function updateVariants() {
            var map = FAPI_UI.availablePlans;
            var itemSelected = document.getElementById('planSelect').value;

            const node = document.getElementById('variantSelectors');
            while (node.firstChild) {
                node.removeChild(node.firstChild);
            }

            if (map[itemSelected] && map[itemSelected].variants && Object.keys(map[itemSelected].variants).length > 0) {

                // update the variant display
                _.each(map[itemSelected].variants, function(values, parameter) {

                    var id = 'vp_' + parameter;
                    var selector = '<div class="mb-3 row">' +
                            '<label for="' + id + '" class="col-md-2 col-form-label">' + values.variantInfo.displayName + '</label>' +
                            '<div class="col-md-10">' +
                            '<div class="input-group">\n' +
                            '<div class="input-group-text">' +
                            '<span class="bi bi-info-circle-fill" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="' + values.variantInfo.description + '" aria-describedby="tooltip1553"></span>' +
                            '</div>' +
                            '<select class="form-select variant-selector" id="' + id + '" data-variant-parameter="' + parameter + '">' +
                            '<option value="select">--- Select A Variant ----</option>' +
                            '</select></div></div></div>';
                    document.getElementById('variantSelectors').insertAdjacentHTML('beforeend', selector);
                    _.each(values.variantValues, function(info, value) {
                        document.getElementById(id).insertAdjacentHTML('beforeend', FAPI_UI.logTemplates.TEST_OPTION({
                            val: value,
                            display: value
                        }));
                    });

                    // update param presets from query parameter
                    let searchParams = new URLSearchParams(window.location.search);
                    let paramValue = searchParams.get(parameter);
                    if (paramValue) {
                        let variantSelect = document.getElementById(id);
                        variantSelect.value = paramValue;
                        variantSelect.dispatchEvent(new Event('change'));
                    }
                });

                document.getElementById('variantSelectors').style.display = '';
            } else {

                // don't show the variant if there's none to show
                document.getElementById('variantSelectors').style.display = 'none';
            }
            FAPI_UI.activeTooltip();
        }

        function getSelectedVariant() {
            var selection = {};

            document.querySelectorAll('.variant-selector[data-variant-parameter]')?.forEach(function(element) {
                selection[element.getAttribute('data-variant-parameter')] = element.value;
            });
            return selection;
        }

        /**
         *
         */
        function updateJSONFromFormElements() {
            document.getElementById('formInput').querySelectorAll('.config-form-element')?.forEach(function(element) {
                if (element.classList.contains('config-form-element')) {
                    tryPopulateJSONFromElement(element);
                }
            });

            document.getElementById('config').value = JSON.stringify(FAPI_UI.testJSON, null, 4);
        }

        /**
         *
         */
        function updateFormElementsFromJSON() {
            try {
                FAPI_UI.testJSON = JSON.parse(document.getElementById('config').value);
            } catch (e) {
                FAPI_UI.showError({
                    error: e
                });
                return false;
            }

            // valid JSON, but we also want to verify that it is an object at the root node
            if (typeof FAPI_UI.testJSON != 'object') {
                FAPI_UI.showError({
                    error: "Please ensure that your root node JSON is an object"
                });
                return false;
            }

            // clear all form details - we are going to read it in from the JSON
            document.querySelectorAll('.config-form-element')?.forEach(function(element) {
                element.value = "";
            });

            walkJSON(FAPI_UI.testJSON);
        }

        /**
         *
         */
        function walkJSON(element, root) {

            _.each(element, function(value, key, obj) {
                var path;
                if (root != undefined) {
                    path = root + "." + key
                } else {
                    path = key;
                }

                var el = document.querySelector(".config-form-element[data-json-target='" + path + "']");

                if (el != null) {
                    if (_.isArray(value) || _.isObject(value)) {
                        el.value = JSON.stringify(value, null, 4);
                    } else {
                        validateJSONFromFormElement(el, value, el.dataset.jsonType);
                        el.value = value;
                    }
                } else {
                    if (_.isObject(value)) {
                        if (root != undefined) {
                            walkJSON(value, root + "." + key);
                        } else {
                            walkJSON(value, key);
                        }
                    }
                }
            });
        }

        /**
         * Checks if the given form element contains a valid JSON value.
         * If the JSON value is invalid, the given form element is annotated with a validation error marker.
         * @param element
         * @param typeHint
         * @param value
         */
        function validateJSONFromFormElement(element, value, typeHint) {
            if (typeHint !== "jsonobject") {
                // skip validation for non jsonobject input elements
                return;
            }
            let result = validateJSON(value);
            let elementInputGroup = element.closest(".input-group");
            if (!result.valid) {
                // propagate validation error on field via customValidity
                element.setCustomValidity(result.error);
                element.classList.add("is-invalid");

                let validationFeedbackEl = elementInputGroup.parentElement.querySelector(".invalid-feedback");
                if (validationFeedbackEl === null) {
                    validationFeedbackEl = document.createElement('div');
                    validationFeedbackEl.classList.add('invalid-feedback', 'd-block');
                    elementInputGroup.parentElement.appendChild(validationFeedbackEl)
                }
                validationFeedbackEl.innerHTML = result.error;

            } else {
                // reset custom validity
                element.setCustomValidity("");
                element.classList.remove("is-invalid");

                let validationFeedbackEl = elementInputGroup.parentElement.querySelector(".invalid-feedback");
                if (validationFeedbackEl) {
                    validationFeedbackEl.remove();
                }
            }
        }

        function validateJSON(value) {
            if (!value || value.trim() === "") {
                return {valid: true};
            }

            try {
                JSON.parse(value);
                return {valid: true};
            } catch (err) {
                return {valid: false, error: err};
            }
        }

        /**
         * Attempts to populate the JSON configuration from the given HTML element.
         *
         * @param element
         */
        function tryPopulateJSONFromElement(element) {
            let value = element.value;
            let type = element.dataset.jsonType;
            validateJSONFromFormElement(element, value, type)
            let key = element.dataset.jsonTarget;
            populateJSON(key, value, type);
        }

        /**
         * Tries to parse the value as a JSON type and populates the FAPI UI with the resulting value.
         *
         * @param key
         * @param val
         * @param type
         */
        function populateJSON(key, val, type) {
            // preserve valid json objects and arrays as json values; store everything else as a string
            // This has an odd side effect that (say) a jwks that is invalid json (e.g. extra or missing comma) is
            // inserted as a string
            if (val === "") { // if we have an empty string then delete the value
                FAPI_UI.removeFromObject(FAPI_UI.testJSON, key);
                return;
            }

            try {
                const stringToJSON = JSON.parse(val); // an array, object or number ?
                if (_.isArray(stringToJSON) || _.isObject(stringToJSON)) {
                    FAPI_UI.prop(FAPI_UI.testJSON, key, stringToJSON);
                } else {
                    // something parseable as json but not an object/array (e.g. a number or boolean) - insert as a string
                    // this makes sure that, e.g., fully numeric client ids are stored in the config as a string as the
                    // code expects
                    FAPI_UI.prop(FAPI_UI.testJSON, key, val);
                }
            } catch (e) { // a string
                if (type === "jsonobject") {
                    console.warn(`Error while populating json value for ${key}`, e);
                }
                FAPI_UI.prop(FAPI_UI.testJSON, key, val);
            }

            //console.log("FAPI_UI.testJSON=" + JSON.stringify(FAPI_UI.testJSON));
        }

        function loadServerInfo() {
            return fetch('/api/server')
                .then((response) => response.json())
                .then((data) => {
                    const textStr =
                        [(data.hasOwnProperty("external_ip") ? "External IP: " + data.external_ip:""),
                         (data.hasOwnProperty("version") ? "Version: " +data.version:"")].filter(Boolean).join(" - ");

                    const element = document.querySelector('.serverInfo');
                    element.textContent = textStr;
                });
        }

        function tryGetStorage(type) {
            // simple check to see whether browser storage is usable
            try {
                var storage = window[type];
                var x = '__storage_test__';
                storage.setItem(x, x);
                storage.removeItem(x);
                return storage;
            } catch (e) {
                return null;
            }
        }
    </script>

    <footer class="pageFooter">
        <span class="muted">OpenID Foundation conformance suite</span>
        <div class="serverInfo"></div>
    </footer>
</body>
</html>
