[
    {
        "test-name": "fapi1-advanced-final-discovery-end-point-verification",
        "variant": {
                "fapi_profile": "openbanking_uk"
        },
        "configuration-filename": "authlete-*.json",
        "current-block": "",
        "condition": "CheckJwksUriIsHostedOnOpenBankingDirectory",
        "expected-result": "warning",
        "comment": "this occurs on everything except production bank deployments"
    },
    {
        "test-name": "fapi1-advanced-final-attempt-reuse-authorisation-code-after-one-second",
        "variant": "*",
        "configuration-filename": "authlete*.json",
        "current-block": "Testing if access token was revoked after authorization code reuse (the AS 'should' have revoked the access token)",
        "condition": "EnsureHttpStatusCodeIs4xx",
        "expected-result": "warning",
        "comment": "known case where authlete doesn't implement a 'should'"
    },
    {
        "test-name": "fapi2-baseline-id2-attempt-reuse-authorisation-code-after-one-second",
        "variant": "*",
        "configuration-filename": "authlete*.json",
        "current-block": "Testing if access token was revoked after authorization code reuse (the AS 'should' have revoked the access token)",
        "condition": "EnsureHttpStatusCodeIs4xx",
        "expected-result": "warning",
        "comment": "known case where authlete doesn't implement a 'should'"
    },
    {
        "test-name": "fapi1-advanced-final-refresh-token",
        "variant": {
                "client_auth_type": "private_key_jwt",
                "fapi_profile": "openbanking_uk",
                "fapi_response_mode": "plain_response"
        },
        "configuration-filename": "authlete-fapi-rw-id2-ob-privatekey.json",
        "current-block": "Second client: Check for refresh token",
        "condition": "FAPIEnsureServerConfigurationDoesNotSupportRefreshToken",
        "expected-result": "warning",
        "comment": "The second client in this configuration does not get issued a refresh token, which is now a warning"
    },
    {
        "test-name": "oidcc-codereuse-30seconds",
        "variant": "*",
        "configuration-filename": "authlete-*.json",
        "current-block": "Testing if access token was revoked after authorization code reuse (the AS 'should' have revoked the access token)",
        "condition": "EnsureHttpStatusCodeIs4xx",
        "expected-result": "warning",
        "comment": "known case where authlete doesn't implement a 'should'"
    },
    {
        "test-name": "oidcc-server-rotate-keys",
        "variant": "*",
        "configuration-filename": "authlete-*.json",
        "current-block": "",
        "condition": "VerifyNewJwksHasNewSigningKey",
        "expected-result": "failure",
        "comment": "CI can't trigger key rotation"
    },
    {
        "test-name": "oidcc-userinfo-post-body",
        "variant": "*",
        "configuration-filename": "authlete-*.json",
        "current-block": "",
        "condition": "UserInfoEndpointWithAccessTokenInBodyNotSupported",
        "expected-result": "warning",
        "comment": "Authlete doesn't support POST with access token in body, which is not required"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-op-test-config.json",
        "current-block": "Verify token endpoint response",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-op-test-config-accounts.json",
        "current-block": "Use client_credentials grant to obtain Brazil consent",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-op-test-config-accounts.json",
        "current-block": "Verify token endpoint response",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": {
            "fapi_response_mode": "plain_response"
        },
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-op-test-config.json",
        "current-block": "Verify authorization endpoint response",
        "condition": "ValidateIdTokenACRClaimAgainstRequest",
        "expected-result": "failure",
        "comment": "RP tests currently don't return requested acr values"
    },
    {
        "test-name": "fapi1-advanced-final-ensure-request-object-with-multiple-aud-succeeds",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-op-test-config.json",
        "current-block": "Verify token endpoint response",
        "condition": "ValidateIdTokenACRClaimAgainstRequest",
        "expected-result": "failure",
        "comment": "RP tests currently don't return requested acr values"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-*.json",
        "current-block": "Use client_credentials grant to obtain Brazil consent",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi1-advanced-final-brazildcr-happy-flow",
        "variant": "*",
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-brazil-*.json",
        "current-block": "Verify token endpoint response",
        "condition": "ExtractExpiresInFromTokenEndpointResponse",
        "expected-result": "warning",
        "comment": "RP tests currently don't return expires_in; it's optional, albeit recommended, in the specs"
    },
    {
        "test-name": "fapi2-baseline-id2-test-claims-parameter-identity-claims",
        "variant": "*",
        "configuration-filename": "authlete-*.json",
        "current-block": "",
        "condition": "EnsureIdentityClaimsContainRequestedClaims",
        "expected-result": "warning",
        "comment": "Authlete doesn't return all the claims currently"
    },
    {
        "test-name": "fapi2-baseline-id2-idmvp-test-claims-parameter-idtoken-identity-claims",
        "variant": {
            "fapi_profile": "idmvp"
        },
        "configuration-filename": "../conformance-suite/scripts/test-configs-rp-against-op/fapi-op-test-config-idmvp.json",
        "current-block": "Verify token endpoint response",
        "condition": "EnsureIdTokenContainsRequestedClaims",
        "expected-result": "failure",
        "comment": "The RP tests currently don't return the required identity claims"
    },
    {
        "test-name": "fapi2-baseline-id2-dpop-negative-tests",
        "variant": {
            "sender_constrain": "dpop"
        },
        "configuration-filename": "authlete-*.json",
        "current-block": "Try DPoP proof where 'iat' is one hour in the past",
        "condition": "EnsureHttpStatusCodeIs401",
        "expected-result": "failure",
        "comment": "Authlete test system isn't currently making this check"
    }
]
